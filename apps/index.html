<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>CodexManager</title>
        <link rel="stylesheet" href="/src/styles/base.css" />
        <link rel="stylesheet" href="/src/styles/layout.css" />
        <link rel="stylesheet" href="/src/styles/components.css" />
        <link rel="stylesheet" href="/src/styles/responsive.css" />
    </head>
    <body>
        <div class="app-shell">
            <header id="topNav" class="top-nav">
                <div class="brand">
                    <span class="brand-mark">CM</span>
                    <div class="brand-meta">
                        <h1>CodexManager</h1>
                        <span>账号池 · 用量管理</span>
                    </div>
                </div>
                <nav class="pill-nav">
                    <button id="navDashboard" class="active">仪表盘</button>
                    <button id="navAccounts">账号管理</button>
                    <button id="navApiKeys">平台 Key</button>
                    <button id="navRequestLogs">请求日志</button>
                </nav>
            </header>

            <main class="content">
                <section class="page-head">
                    <div class="page-title">
                        <h2 id="pageTitle">仪表盘</h2>
                        <p class="hint">可用状态与用量概览</p>
                    </div>
                    <div class="top-actions">
                        <div class="service-setup">
                            <input id="serviceAddr" type="text" placeholder="端口，如 5050" />
                            <button id="serviceToggle" class="secondary">启动服务</button>
                        </div>
                        <div class="service-meta">
                            <div id="status" class="status-pill">未启动</div>
                            <div id="serviceHint" class="hint"></div>
                        </div>
                        <div class="theme-popover">
                            <button
                                id="themeToggle"
                                class="secondary theme-toggle"
                                type="button"
                                aria-expanded="false"
                                aria-controls="themePanel"
                            >
                                主题
                            </button>
                            <div
                                id="themePanel"
                                class="theme-panel"
                                aria-label="主题切换"
                                hidden
                            ></div>
                        </div>
                    </div>
                </section>

                <section id="pageDashboard" class="page active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon"></div>
                            <div class="stat-body">
                                <h3>总账号数</h3>
                                <div id="metricTotal" class="stat">0</div>
                                <div class="metric-sub">总数</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"></div>
                            <div class="stat-body">
                                <h3>可用账号</h3>
                                <div id="metricAvailable" class="stat">0</div>
                                <div class="metric-sub">当前可用</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"></div>
                            <div class="stat-body">
                                <h3>不可用账号</h3>
                                <div id="metricUnavailable" class="stat">0</div>
                                <div class="metric-sub">额度不足</div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-duo">
                        <div id="currentAccountCard" class="card"></div>
                        <div id="recommendations" class="card"></div>
                    </div>
                </section>

                <section id="pageAccounts" class="page">
                    <div id="accountsToolbar" class="accounts-toolbar">
                        <div class="toolbar-left">
                            <div class="search-field">
                                <input id="accountSearch" placeholder="搜索账号名 / ID..." />
                            </div>
                            <div class="search-field">
                                <select id="accountGroupFilter" class="inline-select">
                                    <option value="all">全部分组</option>
                                </select>
                            </div>
                            <div class="segmented">
                                <button id="filterAll" class="active">全部</button>
                                <button id="filterActive">可用</button>
                                <button id="filterLow">低配额</button>
                            </div>
                        </div>
                        <div class="actions">
                            <button id="addAccount" class="ghost">添加账号</button>
                            <button id="refreshAll">刷新所有</button>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="table-wrap">
                            <table class="data-table account-table">
                                <thead>
                                    <tr>
                                        <th>账号</th>
                                        <th>分组</th>
                                        <th>顺序</th>
                                        <th>可用状态</th>
                                        <th>最近刷新</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="accountRows"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="pageApiKeys" class="page">
                    <div class="panel">
                        <div class="panel-header">
                            <div>
                                <h3>平台 Key</h3>
                                <p>创建/管理网关调用所需的 Key</p>
                            </div>
                            <button id="createApiKey" class="secondary">创建 Key</button>
                        </div>
                        <div class="table-wrap">
                            <table class="data-table api-table">
                                <thead>
                                    <tr>
                                        <th>Key ID</th>
                                        <th>名称</th>
                                        <th>绑定模型</th>
                                        <th>状态</th>
                                        <th>最近使用</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="apiKeyRows"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="pageRequestLogs" class="page">
                    <div class="panel">
                        <div class="panel-header">
                            <div>
                                <h3>请求日志</h3>
                                <p>追踪每次请求的模型、状态码和错误信息</p>
                            </div>
                            <div class="toolbar-actions">
                                <div class="segmented log-segmented">
                                    <button id="filterLogAll" class="active">全部</button>
                                    <button id="filterLog2xx">2xx</button>
                                    <button id="filterLog4xx">4xx</button>
                                    <button id="filterLog5xx">5xx</button>
                                </div>
                                <input id="requestLogSearch" placeholder="搜索，支持 method:GET / status:5xx / key:abc" />
                                <button id="clearRequestLogs" class="danger">清空日志</button>
                                <button id="refreshRequestLogs" class="secondary">刷新</button>
                            </div>
                        </div>
                        <div class="table-wrap requestlog-wrap">
                            <table class="data-table requestlog-table">
                                <thead>
                                    <tr>
                                        <th>时间</th>
                                        <th>Key ID</th>
                                        <th>方法</th>
                                        <th>路径</th>
                                        <th>模型</th>
                                        <th>请求等级</th>
                                        <th>状态</th>
                                        <th>错误</th>
                                    </tr>
                                </thead>
                                <tbody id="requestLogRows"></tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </main>
        </div>
        <div id="startupMask" class="startup-mask active" aria-live="polite">
            <div class="startup-mask-card">
                <div class="startup-spinner" aria-hidden="true"></div>
                <strong>正在启动服务</strong>
                <div id="startupMaskText" class="hint">
                    正在连接本地服务并加载页面数据...
                </div>
            </div>
        </div>
        <div id="modalAccount" class="modal">
            <div class="modal-card">
                <div class="modal-header">
                    <h3>新增账号</h3>
                </div>
                <div class="modal-body">
                    <label>标签（逗号分隔）</label>
                    <input id="inputTags" placeholder="例如：高频, 团队A" />
                    <label>备注/描述</label>
                    <input id="inputNote" placeholder="例如：主号 / 测试号" />
                    <label>分组</label>
                    <select id="inputGroup">
                        <option value="">请选择</option>
                        <option value="TEAM">TEAM</option>
                        <option value="PERSONAL">PERSONAL</option>
                    </select>
                    <div id="loginHint" class="hint">
                        点击登录后会打开浏览器完成授权。
                    </div>
                    <div class="login-url">
                        <input id="loginUrl" class="mono" readonly value="" />
                        <button id="copyLoginUrl" class="secondary">
                            复制链接
                        </button>
                    </div>
                    <label>回调链接（端口占用时可手动解析）</label>
                    <div class="login-url">
                        <input
                            id="manualCallbackUrl"
                            class="mono"
                            placeholder="粘贴回调链接"
                        />
                        <button id="manualCallbackSubmit" class="secondary">
                            解析回调
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="submitLogin">登录授权</button>
                    <button id="cancelLogin" class="secondary">取消</button>
                </div>
            </div>
        </div>

        <div id="modalUsage" class="modal">
            <div class="modal-card">
                <div class="modal-header">
                    <h3 id="usageTitle">用量查询</h3>
                    <button id="closeUsageModal" class="ghost">关闭</button>
                </div>
                <div class="modal-body">
                    <div id="usageProgress" class="progress"></div>
                    <div id="usageDetail" class="hint">等待刷新...</div>
                </div>
                <div class="modal-footer">
                    <button id="refreshUsageSingle">刷新用量</button>
                </div>
            </div>
        </div>

        <div id="modalApiKey" class="modal">
            <div class="modal-card">
                <div class="modal-header">
                    <h3>创建平台 Key</h3>
                </div>
                <div class="modal-body">
                    <label>名称（可选）</label>
                    <input
                        id="inputApiKeyName"
                        placeholder="例如：主机房 / 测试"
                    />
                    <label>模型配置</label>
                    <select id="inputApiKeyModel">
                        <option value="">跟随请求模型（不覆盖）</option>
                    </select>
                    <label>推理等级</label>
                    <select id="inputApiKeyReasoning">
                        <option value="">跟随请求等级（不覆盖）</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                        <option value="xhigh">XHigh</option>
                    </select>
                    <label>平台 Key</label>
                    <div class="login-url">
                        <input id="apiKeyValue" class="mono" readonly value="" />
                        <button id="copyApiKey" class="secondary">复制Key</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="submitApiKey">完成</button>
                    <button id="cancelApiKey" class="secondary">关闭</button>
                </div>
            </div>
        </div>
        <div id="modalConfirm" class="modal">
            <div class="modal-card confirm-card">
                <div class="modal-header">
                    <h3 id="confirmTitle">确认操作</h3>
                </div>
                <div class="modal-body">
                    <p id="confirmMessage">请确认是否继续。</p>
                </div>
                <div class="modal-footer">
                    <button id="confirmOk">确定</button>
                    <button id="confirmCancel" class="secondary">取消</button>
                </div>
            </div>
        </div>
        <div id="appToast" class="app-toast" aria-live="polite"></div>
        <script type="module" src="/src/main.js"></script>
    </body>
</html>

